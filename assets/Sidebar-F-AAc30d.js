import{j as s,d as G,e as z,u as A,a as P,r as l,A as N,b as S}from"./index-7bT8f9QX.js";import{L as U}from"./logo-DauWxPY-.js";import{u as W}from"./useQuery-BuZ8gAIr.js";import{u as J}from"./useSidebar-UBrDuHvo.js";const M=({size:e})=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",children:s.jsx("path",{fill:"#000",d:"M5 2h14a1 1 0 0 1 1 1v19.143a.5.5 0 0 1-.766.424L12 18.03l-7.234 4.536A.5.5 0 0 1 4 22.143V3a1 1 0 0 1 1-1m13 2H6v15.432l6-3.761l6 3.761z"})}),I=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",viewBox:"0 0 24 24",children:s.jsx("path",{fill:"#fd0000",d:"M5 2h14a1 1 0 0 1 1 1v19.143a.5.5 0 0 1-.766.424L12 18.03l-7.234 4.536A.5.5 0 0 1 4 22.143V3a1 1 0 0 1 1-1"})}),K=()=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",children:[s.jsx("rect",{width:"16",height:"16",fill:"none"}),s.jsx("path",{fill:"#fd0000",fillRule:"evenodd",d:"M9 2H7a.5.5 0 0 0-.5.5V3h3v-.5A.5.5 0 0 0 9 2m2 1v-.5a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2V3H2.251a.75.75 0 0 0 0 1.5h.312l.317 7.625A3 3 0 0 0 5.878 15h4.245a3 3 0 0 0 2.997-2.875l.318-7.625h.312a.75.75 0 0 0 0-1.5zm.936 1.5H4.064l.315 7.562A1.5 1.5 0 0 0 5.878 13.5h4.245a1.5 1.5 0 0 0 1.498-1.438zm-6.186 2v5a.75.75 0 0 0 1.5 0v-5a.75.75 0 0 0-1.5 0m3.75-.75a.75.75 0 0 1 .75.75v5a.75.75 0 0 1-1.5 0v-5a.75.75 0 0 1 .75-.75",clipRule:"evenodd"})]}),V=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:s.jsx("path",{fill:"#000",d:"M12 10a2 2 0 1 0 2 2a2 2 0 0 0-2-2m-7 0a2 2 0 1 0 2 2a2 2 0 0 0-2-2m14 0a2 2 0 1 0 2 2a2 2 0 0 0-2-2"})});function F(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",viewBox:"0 0 24 24",children:s.jsx("path",{fill:"none",stroke:"black",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9h8m-8 4h6m-5 5H6a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3h-3l-3 3z"})})}const O=()=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",children:[s.jsx("rect",{width:"24",height:"24",fill:"none"}),s.jsx("path",{fill:"#000000",fillRule:"evenodd",d:"M14.757 2.621a4.682 4.682 0 0 1 6.622 6.622l-9.486 9.486c-.542.542-.86.86-1.216 1.137q-.628.492-1.35.835c-.406.193-.834.336-1.56.578l-3.332 1.11l-.802.268a1.81 1.81 0 0 1-2.29-2.29l1.378-4.133c.242-.727.385-1.155.578-1.562q.344-.72.835-1.35c.276-.354.595-.673 1.137-1.215zM4.4 20.821l2.841-.948c.791-.264 1.127-.377 1.44-.526q.572-.274 1.073-.663c.273-.214.525-.463 1.115-1.053l7.57-7.57a7.36 7.36 0 0 1-2.757-1.744A7.36 7.36 0 0 1 13.94 5.56l-7.57 7.57c-.59.589-.84.84-1.053 1.114q-.39.5-.663 1.073c-.149.313-.262.649-.526 1.44L3.18 19.6zM15.155 4.343c.035.175.092.413.189.69a5.86 5.86 0 0 0 1.4 2.222a5.86 5.86 0 0 0 2.221 1.4c.278.097.516.154.691.189l.662-.662a3.182 3.182 0 0 0-4.5-4.5z",clipRule:"evenodd"})]}),X=({handleEdit:e,handleDelete:a,atEnd:d,removeBookmark:c,addBookmark:B,isBookmarked:f})=>s.jsxs("div",{className:`absolute w-24 ${d?"bottom-1/2":"top-1/2"} right-0 z-50 flex flex-col border bg-white p-0.5 rounded-lg`,children:[s.jsxs("button",{className:"flex gap-2 hover:bg-gray-100 p-2 items-center rounded",onClick:h=>{h.stopPropagation(),e()},children:[s.jsx(O,{}),s.jsx("p",{className:"text-sm",children:"Edit"})]}),f?s.jsxs("button",{className:"flex gap-2 hover:bg-gray-100 p-2 items-center rounded",onClick:h=>{h.stopPropagation(),c()},children:[s.jsx(I,{}),s.jsx("p",{className:"text-red-500 text-sm",children:"Remove"})]}):s.jsxs("button",{className:"flex gap-2 hover:bg-gray-100 p-2 items-center rounded",onClick:h=>{h.stopPropagation(),B()},children:[s.jsx(M,{size:"1rem"}),s.jsx("p",{className:"text-sm",children:"Save"})]}),s.jsxs("button",{className:"flex gap-2 hover:bg-gray-100 p-2 items-center rounded",onClick:h=>{h.stopPropagation(),a()},children:[s.jsx(K,{}),s.jsx("p",{className:"text-red-500 text-sm",children:"Delete"})]})]}),L=G((e,a)=>({bookmarkState:!1,historyState:!1,toggleBookmark:()=>e({bookmarkState:!a().bookmarkState}),toggleHistory:()=>e({historyState:!a().historyState})})),Q=G(e=>({bookmarks:[],addBookmark:a=>e(d=>({bookmarks:[...d.bookmarks,a]})),setAllBookmarks:a=>e({bookmarks:a})})),q=({item:e,modalFor:a,getHistory:d,handleOpenModal:c,handleStopNewChat:B,atEnd:f})=>{const{HF_email:h}=z(),{session:E,setSession:$}=A(),{clearChats:H}=P(),{toggleHistory:D,toggleBookmark:i}=L(),{bookmarks:m}=Q(),k=l.useRef(null),R=l.useRef(null),[v,y]=l.useState(""),[C,n]=l.useState(!1);l.useEffect(()=>{e.session_name&&y(e.session_name)},[e]);const x=()=>{n(!0),v||y(e.first_message),c(void 0),setTimeout(()=>{var t;(t=R.current)==null||t.focus()},0)},j=async()=>{try{const t=`${N}/history/`,p={data:{HF_email:h,session:e.session_id}};await S.delete(t,p),e.session_id===E&&($(""),H(),B()),D()}catch(t){console.log(t)}c(void 0)},b=async()=>{try{const t=`${N}/rename_session/`,p={session_id:e==null?void 0:e.session_id,session_name:v},{data:g}=await S.patch(t,p);D(),i(),console.log(g)}catch(t){console.log(t)}n(!1)},w=l.useCallback(t=>{k.current&&!k.current.contains(t.target)&&c(void 0)},[c]),u=async()=>{try{const t=`${N}/bookmark/`,p={session_id:e.session_id};await S.post(t,p),i()}catch(t){console.log(t)}},o=async()=>{try{const t=`${N}/bookmark/`,p={data:{session_id:e==null?void 0:e.session_id}};await S.delete(t,p),i()}catch(t){console.log(t)}};l.useEffect(()=>(document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}),[w]);const r=m.some(t=>t.session_id===e.session_id);return s.jsx(s.Fragment,{children:s.jsxs("div",{className:`flex gap-2 items-center hover:bg-gray-100 p-1 rounded mr-3 group justify-between relative cursor-pointer ${(a==null?void 0:a.session_id)===e.session_id?"bg-gray-100":""}`,onClick:()=>d(e==null?void 0:e.session_id),children:[s.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[s.jsxs("div",{className:"relative",children:[s.jsx(F,{}),r&&s.jsx("div",{className:"absolute top-0 right-0 z-50 bg-white",children:s.jsx(M,{size:"0.6rem"})})]}),C?s.jsxs("form",{onSubmit:t=>{t.preventDefault(),b()},children:[s.jsx("input",{ref:R,type:"text",value:v,onChange:t=>y(t.target.value),className:"border-b-2 border-primary bg-white px-2",onClick:t=>t.stopPropagation(),onBlur:b}),s.jsx("button",{className:"hidden",children:"Submit"})]}):s.jsx("p",{className:"whitespace-nowrap truncate",children:v||(e==null?void 0:e.first_message)})]}),!C&&s.jsx("button",{className:"group-hover:flex hidden",onClick:t=>{t.stopPropagation(),c(e)},children:s.jsx(V,{})}),(a==null?void 0:a.session_id)===e.session_id&&s.jsx("div",{ref:k,children:s.jsx(X,{handleEdit:x,handleDelete:j,atEnd:f,removeBookmark:o,addBookmark:u,isBookmarked:r})})]},e==null?void 0:e.session_id)})},T=(e=0)=>{const a=new Date;return a.setDate(a.getDate()+e),a.toISOString().split("T")[0]},Z=({handleStopNewChat:e})=>{const{chats:a,clearChats:d,historyChat:c}=P(),{setSession:B}=A(),{HF_email:f}=z(),{historyState:h}=L(),[E,$]=l.useState([]),[H,D]=l.useState([]),[i,m]=l.useState([]),[k,R]=l.useState(),v=n=>{R(n)},y=async n=>{e();try{const x=`${N}/history/`,j={HF_email:f,session:n},{data:b}=await S.post(x,j);d(),B(n);const w=[];b.forEach(u=>{const o={id:u.ques_id,answer:u.output,message:u.input_prompt,outputTimestamp:u.output_timestamp,inputTimestamp:u.input_prompt_timestamp,feedback:u.feedback?u.feedback:"neutral"};w.push(o)}),c(w)}catch(x){console.error(x)}},C=n=>{var x,j,b;return i.length+E.length+H.length>3&&(((x=i[i.length-1])==null?void 0:x.session_id)===n.session_id||((j=i[i.length-2])==null?void 0:j.session_id)===n.session_id||((b=i[i.length-3])==null?void 0:b.session_id)===n.session_id)};return l.useEffect(()=>{const n=async()=>{try{const x=`${N}/history/`,j={HF_email:f},{data:b}=await S.post(x,j),w=b.filter(g=>g.first_message!==""),u=T(0),o=T(-1),r=[],t=[],p=[];w.forEach(g=>{var _;g.created_on.split("T")[0]===u?r.push(g):((_=g==null?void 0:g.created_on)==null?void 0:_.split("T")[0])===o?t.push(g):p.push(g)}),$(r),D(t),m(p)}catch(x){console.error(x)}};f.length!==0&&n()},[f,a,h]),s.jsxs("div",{className:"h-full overflow-hidden",children:[s.jsx("p",{className:"text-headGrey font-bold text-lg",children:"History"}),s.jsxs("div",{className:"h-full flex flex-col gap-6 flex-1 overflow-x-hidden overflow-y-auto pb-6",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("p",{className:"text-headGrey font-bold",children:"Today"}),s.jsxs("div",{className:"flex-1 min-h-10 flex flex-col",children:[E.map(n=>s.jsx(q,{modalFor:k,handleOpenModal:v,getHistory:y,item:n,handleStopNewChat:e,atEnd:C(n)},n==null?void 0:n.session_id)),!E.length&&s.jsx("p",{className:"pl-2 text-headGrey font-semibold text-sm",children:"No history yet"})]})]}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("p",{className:"text-headGrey font-bold",children:"Yesterday"}),s.jsxs("div",{className:"flex-1 min-h-10 flex flex-col",children:[H.map(n=>s.jsx(q,{modalFor:k,handleOpenModal:v,getHistory:y,item:n,handleStopNewChat:e,atEnd:C(n)},n==null?void 0:n.session_id)),!H.length&&s.jsx("p",{className:"pl-2 text-headGrey font-semibold text-sm",children:"No history yet"})]})]}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("p",{className:"text-headGrey font-bold",children:"Previous 7 days"}),s.jsxs("div",{className:"flex-1 min-h-10 flex flex-col",children:[i.map(n=>s.jsx(q,{modalFor:k,handleOpenModal:v,getHistory:y,item:n,handleStopNewChat:e,atEnd:C(n)},n==null?void 0:n.session_id)),!i.length&&s.jsx("p",{className:"pl-2 text-headGrey font-semibold text-sm",children:"No history yet"})]})]})]})]})},ss=({handleDelete:e,handleEdit:a,item:d})=>s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:"flex gap-2 hover:bg-gray-100 p-2 items-center rounded",onClick:c=>{c.stopPropagation(),a(d)},children:[s.jsx(O,{}),s.jsx("p",{className:"text-sm",children:"Edit"})]}),s.jsxs("button",{className:"flex gap-2 hover:bg-gray-100 p-2 items-center rounded",onClick:c=>{c.stopPropagation(),e(d)},children:[s.jsx(I,{}),s.jsx("p",{className:"text-red-500 text-sm",children:"Remove"})]})]}),es=({handleStopNewChat:e})=>{const{bookmarks:a,setAllBookmarks:d}=Q(),{HF_email:c}=z(),{bookmarkState:B,toggleHistory:f,toggleBookmark:h}=L(),{clearChats:E,historyChat:$}=P(),{setSession:H}=A(),D=l.useRef(null),i=l.useRef(null),[m,k]=l.useState(),[R,v]=l.useState(""),[y,C]=l.useState(),n=async o=>{e();try{const r=`${N}/history/`,t={HF_email:c,session:o},{data:p}=await S.post(r,t);E(),H(o);const g=[];p.forEach(_=>{const Y={id:_.ques_id,answer:_.output,message:_.input_prompt,outputTimestamp:_.output_timestamp,inputTimestamp:_.input_prompt_timestamp,feedback:_.feedback?_.feedback:"neutral"};g.push(Y)}),$(g)}catch(r){console.error(r)}},x=async()=>{try{if(!m)return;const o=`${N}/bookmark/`,r={data:{session_id:m.session_id}};await S.delete(o,r),u()}catch(o){console.log(o)}},j=l.useCallback(o=>{i.current&&!i.current.contains(o.target)&&k(void 0)},[]),b=async o=>{try{const r=`${N}/rename_session/`,t={session_id:o.session_id,session_name:R},{data:p}=await S.patch(r,t);f(),h(),console.log(p)}catch(r){console.log(r)}C(void 0)},w=o=>{C(o),o.session_name||v(o.first_message),k(void 0),setTimeout(()=>{var r;(r=D.current)==null||r.focus()},0)};l.useEffect(()=>(document.addEventListener("mousedown",j),()=>{document.removeEventListener("mousedown",j)}),[j]);const u=l.useCallback(async()=>{try{const o=`${N}/bookmark/?HF_id=${c}`,{data:r}=await S.get(o);d(r)}catch(o){console.log(o)}},[c,d]);return l.useEffect(()=>{c&&u()},[c,u,B]),s.jsxs("div",{children:[s.jsx("p",{className:"text-headGrey font-bold text-lg",children:"Bookmarks"}),s.jsxs("div",{className:"max-h-[200px] min-h-[100px] overflow-y-auto",children:[a==null?void 0:a.map(o=>s.jsxs("div",{className:`flex gap-2 items-center hover:bg-gray-100 p-1 rounded mr-3 group justify-between relative cursor-pointer ${(m==null?void 0:m.session_id)===o.session_id?"bg-gray-100":""}`,onClick:()=>n(o.session_id),children:[s.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[s.jsx("div",{className:"relative",children:s.jsx(F,{})}),(y==null?void 0:y.session_id)===o.session_id?s.jsxs("form",{onSubmit:r=>{r.preventDefault(),b(o)},children:[s.jsx("input",{ref:D,type:"text",value:R,onChange:r=>v(r.target.value),className:"border-b-2 border-primary bg-white px-2",onClick:r=>r.stopPropagation(),onBlur:()=>b(o)}),s.jsx("button",{className:"hidden",children:"Submit"})]}):s.jsx("p",{className:"whitespace-nowrap truncate",children:o.session_name?o.session_name:o==null?void 0:o.first_message})]}),!y&&s.jsx("button",{className:"group-hover:flex hidden",onClick:r=>{r.stopPropagation(),k(o)},children:s.jsx(V,{})}),(m==null?void 0:m.session_id)===o.session_id&&s.jsx("div",{ref:i,className:`absolute ${a.length>2&&(a[a.length-1].session_id===o.session_id||a[a.length-2].session_id===o.session_id)?"bottom-1/2":"top-1/2"} right-0 z-50 flex flex-col border bg-white p-0.5 rounded-lg`,children:s.jsx(ss,{handleEdit:w,handleDelete:x,item:o})})]},o==null?void 0:o.session_id)),!a.length&&s.jsx("p",{className:"pl-2 text-headGrey font-semibold text-sm",children:"No Bookmarks yet"})]})]})},rs=({handleStopNewChat:e})=>{const{clearChats:a}=P(),{state:d,hideSidebar:c}=J(),{setSession:B}=A(),{clearQuery:f}=W(),h=async()=>{c(),f(),B(""),a(),e()};return s.jsxs("section",{className:`h-[100dvh] lg:h-screen bg-white rounded-lg w-72 p-4 ${d?"flex":"hidden"} lg:flex flex-col gap-4 absolute z-40 left-0 top-0 lg:relative shadow-md lg:shadow-none`,children:[s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("img",{src:U,alt:"logo",className:"w-28"}),s.jsx("button",{className:"bg-[#FFE4D4] text-primary w-40 h-10 rounded hover:bg-primary hover:bg-opacity-35",onClick:h,children:"+ New Chat"})]}),s.jsx("div",{className:"border border-borderGrey"}),s.jsx(es,{handleStopNewChat:e}),s.jsx("div",{className:"border border-borderGrey"}),s.jsx(Z,{handleStopNewChat:e})]})};export{rs as default};
